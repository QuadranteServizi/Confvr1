<!DOCTYPE html>
<html>    
  <head>        
    <meta charset="utf-8" />        
    <meta name="viewport" content="width=device-width, user-scalable=no">        
    <link type="text/css" rel="stylesheet" href="css/custom.css">        
    <title>Confcommercio Verona
    </title>                                           
<script type="text/javascript" src="PushNotification.js"></script>         
<script type="text/javascript" src="js/index.js"></script>         
<script type="text/javascript">
                    app.initialize();
        </script>                  
<script type="text/javascript" charset="utf-8" src="js/OptionsMenu.js"/></script>                        
  </head>      
  <body class="corpo">         
    <div class="header">        
      <h1 class="bar">Confcommercio Verona</h1>            
      <div id="homebutton">        
        <a  href="javascript:history.back()">             
          <img src="img/icona.png" alt="Confcommercio Verona" style="vertical-align:middle;"/>        </a>              
      </div>      
    </div>        
    <div class="footer">        
      <h1 class="bar">&copy; 
<script>document.write(new Date().getFullYear()); 
        
        </script> Confcommercio Verona </h1>      
    </div>         
    <div id="spacerhome">        
    </div>          
    <div id="logo-wrap">          
      <img src="img/logo_big.png" alt="Confcommercio Verona" />        
    </div>     
    

    <title>File Create/Remove
    </title>
    </head>
<body>
    <form onsubmit="return saveText()" action="#">
        <label for="username">Username</label><br>
        <input id="username" /><br>

        <label for="password">Password</label><br>
        <input id="password" type="password" /><br>

        <input type="submit" value="Salva" />
    </form>

    <dl id="definitions">
    </dl>
    <script src="phonegap.js"></script>
<script>
/*Preso da http://blog.safaribooksonline.com/2012/02/29/phonegap-storing-and-retrieving-with-the-filesystem/ */
    var FILENAME = 'confcommercio_config.db',
        $ = function (id) {
            return document.getElementById(id);
        },
        file = {
            writer: { available: false },
            reader: { available: false }
        },
        dbEntries = [];

    function saveText(e) {
    var username = $('username').value,
        password = $('password').value,
        fail;

    dbEntries.push('' + username + '' + password + '</dd>')
    $('username').value = '';
    $('password').value = '';
    $('definitions').innerHTML = dbEntries.join('');
    if (file.writer.available) {
       file.writer.available = false;
       file.writer.object.onwriteend = function (evt) {
                  file.writer.available = true; 
                  file.writer.object.seek(0); 
                 } 
        file.writer.object.write(dbEntries.join("n")); 
   } 
   return false; }
</script>
<script>
var failCB = function (msg) {
    return function () {
        alert('[FAIL] ' + msg);
    }
};

function gotFS(fs) {
    var fail = failCB('getFile');
    fs.root.getFile(FILENAME, {create: true, exclusive: false},
                    gotFileEntry, fail);
}
function gotFileEntry(fileEntry) {
    var fail = failCB('createWriter');
    file.entry = fileEntry;

    fileEntry.createWriter(gotFileWriter, fail);
}

function gotFileWriter(fileWriter) {
    file.writer.available = true;
    file.writer.object = fileWriter;
}

function readText() {
    if (file.entry) {
        file.entry.file(function (dbFile) {
            var reader = new FileReader();
            reader.onloadend = function (evt) {
                var textArray = evt.target.result.split("n");

                dbEntries = textArray.concat(dbEntries);

                $('definitions').innerHTML = dbEntries.join('');
            }
            reader.readAsText(dbFile);
        }, failCB("FileReader"));
    }
}


function gotFileEntry(fileEntry) {
    var fail = failCB('createWriter');
    file.entry = fileEntry;

    fileEntry.createWriter(gotFileWriter, fail);
    readText();
}

document.addEventListener('deviceready', function () {
    var fail = failCB('requestFileSystem');
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
}, false);
</script>
</body>
</html>